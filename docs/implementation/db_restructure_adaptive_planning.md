# Implementation Plan: Restructuring for Adaptive Planning

## Proposed Changes

### 1. Domain Layer Refactor (Centralization)
Move training entities from the AI-specific folder to a central location: `lib/features/shared/domain/entities/training/`.
- **[NEW]** `phase.dart`
  - Fields: `id`, `goalId`, `phaseNumber`, `phaseType`, `durationWeeks`, `targetWeeklyVolume`, `targetWeeklyDuration`.
  - **Hydration**: Fields `startDate` and `endDate` are `nullable` and populated by the App.
- **[NEW]** `training_block.dart`
  - Fields: `id`, `phaseId`, `blockNumber`, `intent`.
  - **Hydration**: Fields `startDate` and `endDate` are `nullable` and populated by the App.
- **[MODIFY]** `workout.dart`
  - Rename fields: `mesocycleId` -> `phaseId`, `microcycleId` -> `blockId`.

### 2. Strategic Split: Durations vs. Dates 
To prevent AI "calendar math" errors, we shift responsibility:
- **AI Task**: Generates the plan using **logical durations** (e.g., `Phase 1: 4 weeks`, `Block 1: 7 days`). It identifies specific days by `dayNumber` relative to the phase or block.
- **App Task (`TrainingPlanScheduler`)**: Performs the "Hydration." It takes the current date (or user start date) and calculates the actual `DateTime` objects for every Phase, Block, and Workout.

### 3. Data Layer (Drift)
- **[NEW]** `tables/phases_table.dart`
- **[NEW]** `tables/training_blocks_table.dart`
- **[MODIFY]** `tables/workouts_table.dart`: Rename foreign key columns.
- **[MODIFY]** `drift_database.dart`: Register new tables.

### 4. Application Layer
- **[MODIFY]** `TrainingPlanScheduler`: Update logic to map logical `dayNumbers` and `durationWeeks` to concrete calendar dates.
- **[MODIFY]** `GenerateTrainingPlan` Use Case: Coordinate the saving of the full hierarchy (Phase -> Block -> Workout).

## Verification Plan

### Automated Tests
- Update `TrainingPlanScheduler` unit tests to verify that a 4-week phase generated by the AI correctly maps to 28 days in the database starting from a given Monday.
